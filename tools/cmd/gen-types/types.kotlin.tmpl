// Copyright 2022 The Accumulate Authors
//
// Use of this source code is governed by an MIT-style
// license that can be found in the LICENSE file or at
// https://opensource.org/licenses/MIT.

package {{.Package}}.generated.{{.SubPackage}};

/**
    GENERATED BY go run ./tools/cmd/gen-api. DO NOT EDIT.
**/

import {{.Package}}.protocol.*;
import {{.Package}}.generated.apiv3.*;
import {{.Package}}.generated.protocol.*;
import {{.Package}}.generated.query.*;
import {{.Package}}.generated.config.*;
import {{.Package}}.generated.database.*;
import {{.Package}}.generated.core.*;
import {{.Package}}.generated.errors.Error;
import {{.Package}}.generated.errors.*;
import {{.Package}}.support.*;
import {{.Package}}.support.serializers.*;
import kotlinx.serialization.Required
import kotlinx.serialization.Serializable
import kotlinx.serialization.SerialName
import kotlinx.serialization.Transient

// Type: {{title .Type}}
// UnionTypeEnum: {{.Enumeration}}

@Serializable
sealed class {{title .Type}} : {{.DetermineResponseType}} {

    abstract val type: TransactionType

{{range .Members}}
    @Serializable
    @SerialName("{{lcName .Name}}")
    class {{.UnionValue}}() : {{title .UnionSpec.Type}}() {

    {{- $unionValue := .UnionValue -}}
	{{- range .Fields}}
	{{-   if and (.Virtual) (ne $unionValue "")}}
	    {{   if eq (lcName .Name) "type"}}
	    @Required
        override val {{lcName .Name}}: {{resolveType .}} = {{resolveType .}}.{{underscoreUpperCase $unionValue}}
	    {{   end}}
	{{-   end}}
	{{- end}}

	{{- range .Fields}}
	{{-   if not .Virtual}}
	{{-   if eq .MarshalAs 1 }}
	@Transient{{- end}}
	{{-   if eq (resolveType .) "byte[]" }}
	@Serializable(with = HexDeserializer::class){{- end}}
	{{-   if eq (resolveType .) "byte[][]" }}
	@Serializable(with = Hex2DDeserializer::class){{- end}}
	    var {{lcName .Name}}:{{resolveType .}}? = null

        fun {{lcName .Name}}(value: {{resolveType .}}) : {{$unionValue}} {
            this.{{lcName .Name}} = value
            return this;
        }

	{{-     if eq (resolveType .) "Url"}}
        fun {{lcName .Name}}(value: String) : {{$unionValue}} {
            this.{{lcName .Name}} = Url.parse(value)
            return this;
        }
	{{-     end}}
	{{-     if eq (resolveType .) "ByteArray"}}
        fun {{lcName .Name}}(value: String) : {{$unionValue}} {
            this.{{lcName .Name}} = value.decodeHex()
            return this;
        }
	{{-     end}}
	{{-   end}}
	{{- end}}


        override fun marshalBinary(): ByteArray {
          val marshaller = Marshaller()
        {{- range .Fields}}
        {{-   if and .IsBinary .IsMarshalled}}
        {{-     if .OmitEmpty}}
        {{-       if .Type.IsKnown}}
          {{lcName .Name}}?.let{ marshaller.write{{.Type.Title}}({{.Number}}, it) }
        {{-       else }}
          {{lcName .Name}}?.let { marshaller.writeValue({{.Number}}, it) }
        {{-       end}}
        {{-     else }}
        {{-       if .Type.IsKnown}}
          marshaller.write{{.Type.Title}}({{.Number}}, this.{{lcName .Name}})
        {{-       else }}
          marshaller.writeValue({{.Number}}, {{lcName .Name}});
        {{-       end}}
        {{-     end}}
        {{-   end}}
        {{- end}}
          return marshaller.array();
        }
    }
{{end}}
}