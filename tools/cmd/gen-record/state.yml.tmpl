{{- define "container"}}
{{- if not (excluded .) -}}
full{{.FullName}}State:
  fields:
  {{- range .Parts}}
  {{- if not (excluded .)}}
  {{- if or .Type.IsContainer}}
  - name: {{.Name}}
    type: full{{.FullName}}State
    marshal-as: reference
    pointer: true
  {{- else if .Type.IsChain}}
  - name: {{.Name}}
    type: managed.MerkleState
    marshal-as: reference
    pointer: true
  {{- else if .Type.IsOther}}
  - name: {{.Name}}
    type: full{{.DataType}}State
    marshal-as: reference
    pointer: true
  {{- else if .Type.IsState}}
  - name: {{.Name}}
    type: {{.DataType}}
    {{- if .Union}}
    marshal-as: union
    {{- else}}
    marshal-as: reference
    {{- end}}
    {{- if or .Set .Counted}}
    repeatable: true
    {{- end}}
    {{- if .Pointer}}
    pointer: true
    {{- end}}
  {{- end}}
  {{- end}}
  {{- end}}

{{  end}}
{{- range .Parts}}
{{- if .Type.IsContainer}}
{{- template "container" .}}
{{- end}}
{{- end}}
{{- end}}

{{- range .Records}}
{{- template "container" .}}
{{- end}}