Envelope:
  fields:
    - name: Signatures
      repeatable: true
      type: protocol.Signature
      marshal-as: union
    - name: TxHash
      type: bytes
      optional: true
    - name: Transaction
      type: protocol.Transaction
      marshal-as: reference
      pointer: true
      optional: true
      repeatable: true
    - name: Messages
      type: Message
      marshal-as: union
      optional: true
      repeatable: true

TransactionMessage:
  union: { type: message }
  fields:
    - name: Transaction
      type: protocol.Transaction
      marshal-as: reference
      pointer: true

SignatureMessage:
  union: { type: message }
  fields:
    - name: Signature
      type: protocol.Signature
      marshal-as: union
    - name: TxID
      type: txid
      pointer: true

SequencedMessage:
  union: { type: message }
  fields:
    - name: Message
      type: Message
      marshal-as: union
    - name: Source
      description: is the source that produced the transaction
      type: url
      pointer: true
      optional: true
    - name: Destination
      description: is the destination that the transaction is sent to
      type: url
      pointer: true
      optional: true
    - name: Number
      description: is the sequence number of the transaction
      type: uint
      optional: true

SyntheticMessage:
  # TODO Update to have multiple transactions with a list receipt
  union: { type: message }
  fields:
    - name: Message
      type: Message
      marshal-as: union
    - name: Proof
      type: protocol.AnnotatedReceipt
      marshal-as: reference
      pointer: true

BlockAnchor:
  union: { type: message }
  fields:
    - name: Signature
      type: protocol.KeySignature
      marshal-as: union
    - name: Anchor
      type: Message
      marshal-as: union

SignatureRequest:
  union: { type: message }
  fields:
    - name: Authority
      type: url
      pointer: true
    - name: TxID
      type: txid
      pointer: true
    - name: Cause
      type: txid
      pointer: true

CreditPayment:
  union: { type: message }
  fields:
    - name: Paid
      type: protocol.Fee
      marshal-as: enum
    - name: Payer
      type: url
      pointer: true
    - name: Initiator
      description: indicates whether the signature initiated the transaction
      type: bool
    - name: TxID
      type: txid
      pointer: true
    - name: Cause
      type: txid
      pointer: true

BlockSummary:
  union: { type: message }
  fields:
    - name: Partition
      description: is the ID of the partition of the block
      type: string
    - name: Index
      description: is the index of the block
      type: uint
    - name: StateTreeHash
      description: is the state tree hash after the block
      type: hash
    - name: PreviousBlock
      description: is the index of the previous block (excludes any empty blocks)
      type: uint
    - name: RecordUpdates
      type: RecordUpdate
      marshal-as: reference
      pointer: true
      repeatable: true
    - name: StateTreeUpdates
      type: StateTreeUpdate
      marshal-as: reference
      pointer: true
      repeatable: true

# Components

RecordUpdate:
  fields:
    - name: Key
      type: record.Key
      marshal-as: reference
    - name: Value
      type: bytes

StateTreeUpdate:
  fields:
    - name: Key
      type: record.Key
      marshal-as: reference
    - name: Hash
      type: hash
