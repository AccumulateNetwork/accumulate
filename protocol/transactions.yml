# Transactions - names should be verbs

Envelope:
  fields:
    - name: Signatures
      type: slice
      slice:
        # type: Signature
        # marshal-as: value
        # unmarshal-with: UnmarshalSignature
        type: ED25519Sig
        marshal-as: reference
        pointer: true
    - name: TxHash
      type: bytes
    - name: Transaction
      type: Transaction
      marshal-as: reference
      pointer: true
    - name: hash
      type: bytes
      marshal-as: none

TransactionHeader:
  fields:
    - name: Origin
      type: url.URL
      marshal-as: reference
      pointer: true
    - name: KeyPageHeight
      type: uvarint
    - name: KeyPageIndex
      type: uvarint
    - name: Nonce
      type: uvarint

Transaction:
  embeddings:
    - TransactionHeader
  fields:
    - name: Body
      type: bytes
    - name: hash
      type: bytes
      marshal-as: none

TxState:
  fields:
    - name: SigInfo
      type: TransactionHeader
      marshal-as: reference
      pointer: true
    - name: Transaction
      type: bytes
    - name: TransactionHash
      type: chain
      marshal-as: none

TransactionState:
  kind: chain
  chain-type: Transaction
  omit-new-func: true
  embeddings:
    - TxState

PendingTransactionState:
  kind: chain
  chain-type: PendingTransaction
  omit-new-func: true
  fields:
    - name: Signature
      type: slice
      slice:
        # type: Signature
        # marshal-as: value
        # unmarshal-with: UnmarshalSignature
        type: ED25519Sig
        marshal-as: reference
        pointer: true
    - name: TransactionState
      type: TxState
      marshal-as: reference
      pointer: true
    - name: Status
      type: rawJson

##### User #####

CreateIdentity:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true
    - name: PublicKey
      type: bytes
    - name: KeyBookName
      type: string
      optional: true
    - name: KeyPageName
      type: string
      optional: true
    - name: Manager
      type: string
      optional: true

CreateTokenAccount:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true
    - name: TokenUrl
      type: string
      is-url: true
    - name: KeyBookUrl
      type: string
      is-url: true
      optional: true
    - name: Scratch
      type: bool
      optional: true
    - name: Manager
      type: string
      optional: true

SendTokens:
  kind: tx
  fields:
    - name: Hash
      type: chain
      optional: true
    - name: Meta
      type: rawJson
      optional: true
    - name: To
      type: slice
      slice:
        type: TokenRecipient
        marshal-as: reference
        pointer: true

CreateDataAccount:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true
    - name: KeyBookUrl
      type: string
      is-url: true
      optional: true
    - name: ManagerKeyBookUrl
      type: string
      is-url: true
      optional: true
    - name: Scratch
      type: bool
      optional: true

WriteData:
  kind: tx
  fields:
    - name: Entry
      type: DataEntry
      marshal-as: reference

WriteDataTo:
  kind: tx
  fields:
    - name: Recipient
      type: string
      is-url: true
    - name: Entry
      type: DataEntry
      marshal-as: reference

AcmeFaucet:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true

CreateToken:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true
    - name: KeyBookUrl
      type: string
      is-url: true
      optional: true
    - name: Symbol
      type: string
    - name: Precision
      type: uvarint
    - name: Properties
      type: string
      is-url: true
      optional: true
    - name: InitialSupply
      type: bigint
      optional: true
    - name: HasSupplyLimit
      type: bool
      optional: true
    - name: Manager
      type: string
      optional: true

IssueTokens:
  kind: tx
  fields:
    - name: Recipient
      type: string
      is-url: true
    - name: Amount
      type: bigint

BurnTokens:
  kind: tx
  fields:
    - name: Amount
      type: bigint

CreateKeyPage:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true
    - name: Keys
      type: slice
      slice:
        type: KeySpecParams
        pointer: true
        marshal-as: reference
    - name: Manager
      type: string
      optional: true

CreateKeyBook:
  kind: tx
  fields:
    - name: Url
      type: string
      is-url: true
    - name: Pages
      type: slice
      slice:
        type: string
        is-url: true
    - name: Manager
      type: string
      optional: true

AddCredits:
  kind: tx
  fields:
    - name: Recipient
      type: string
    - name: Amount
      type: uvarint

UpdateKeyPage:
  kind: tx
  fields:
    - name: Operation
      type: KeyPageOperation
      marshal-as: value
    - name: Key
      type: bytes
      optional: true
    - name: NewKey
      type: bytes
      optional: true
    - name: Owner
      type: string
      optional: true
    - name: Threshold
      type: uvarint
      optional: true

SignPending:
  kind: tx
  fields: []

##### Synthetic #####

SyntheticCreateChain:
  kind: tx
  fields:
    - name: Cause
      type: chain
    - name: Chains
      type: slice
      slice:
        type: ChainParams
        marshal-as: reference


SyntheticWriteData:
  kind: tx
  fields:
    - name: Cause
      type: chain
    - name: Entry
      type: DataEntry
      marshal-as: reference

SyntheticDepositTokens:
  kind: tx
  fields:
    - name: Cause
      type: chain
    - name: Token
      type: string
      is-url: true
    - name: Amount
      type: bigint

SyntheticAnchor:
  kind: tx
  fields:
    - name: Source
      type: string
      is-url: true
    - name: Major
      type: bool
    - name: RootAnchor
      type: chain
    - name: RootIndex
      type: uvarint
    - name: Block
      type: uvarint
    - name: SourceIndex
      type: uvarint
    - name: SourceBlock
      type: uvarint
    - name: Receipt
      type: Receipt
      marshal-as: reference

SyntheticDepositCredits:
  kind: tx
  fields:
    - name: Cause
      type: chain
    - name: Amount
      type: uvarint

SyntheticBurnTokens:
  kind: tx
  fields:
    - name: Cause
      type: chain
    - name: Amount
      type: bigint

SyntheticMirror:
  kind: tx
  fields:
    - name: Objects
      type: slice
      slice:
        type: AnchoredRecord
        marshal-as: reference

SegWitDataEntry:
  kind: tx
  fields:
    - name: Cause
      type: chain
    - name: EntryUrl
      type: string
      is-url: true
    - name: EntryHash
      type: chain

##### Result Types #####

WriteDataResult:
  kind: tx-result
  fields:
    - name: EntryHash
      type: chain
    - name: AccountUrl
      type: url.URL
      marshal-as: reference
      pointer: true
    - name: AccountID
      type: bytes

##### Data Types #####

TokenRecipient:
  fields:
    - name: Url
      type: string
      is-url: true
    - name: Amount
      type: bigint

ChainParams:
  fields:
    - name: Data
      type: bytes
    - name: IsUpdate
      type: bool

KeySpecParams:
  fields:
    - name: PublicKey
      type: bytes

AnchoredRecord:
  fields:
    - name: Record
      type: bytes
    - name: Anchor
      type: chain

RemoveManager:
  kind: tx
  fields: