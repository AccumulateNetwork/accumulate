# Accounts and Transactions used internally by the protocol (not available to
# the user)

##### Accounts #####

SystemLedger:
  union: { type: account }
  fields:
    - name: Url
      type: url
      pointer: true
    - name: Index
      type: uint
    - name: Timestamp
      type: time
    - name: AcmeBurnt
      type: bigint
    - name: PendingUpdates
      type: NetworkAccountUpdate
      marshal-as: reference
      repeatable: true
    - name: Anchor
      description: is the block anchor that should be sent for the last block
      type: AnchorBody
      marshal-as: union

SyntheticLedger:
  union: { type: account }
  fields:
    - name: Url
      type: url
      pointer: true
    - name: Partitions
      description: tracks sent and received synthetic transactions
      type: PartitionSyntheticLedger
      marshal-as: reference
      pointer: true
      repeatable: true
    - name: Anchors
      description: tracks sent and received anchors
      type: PartitionSyntheticLedger
      marshal-as: reference
      pointer: true
      repeatable: true

AnchorLedger:
  union: { type: account }
  fields:
    - name: Url
      type: url
      pointer: true
    - name: MinorBlockSequenceNumber
      description: is the sequence number of the last minor block
      type: uint
    - name: MajorBlockIndex
      description: is the block index of the last major block
      type: uint
    - name: MajorBlockTime
      description: is the timestamp of the last major block
      type: time
    - name: PendingMajorBlockAnchors
      description: is the list of partitions that have joined the open major block. If there is no open major block, this is unset
      type: url
      pointer: true
      repeatable: true

##### Transactions #####

SystemGenesis:
  union: { type: transaction }

BlockValidatorAnchor:
  union: { type: transaction }
  embeddings:
    - PartitionAnchor
  fields:
    - name: AcmeBurnt
      description: is the amount of acme tokens burnt in the transaction
      type: bigint

DirectoryAnchor:
  union: { type: transaction }
  embeddings:
    - PartitionAnchor
  fields:
    - name: Updates
      description: are synchronization updates for network accounts
      type: NetworkAccountUpdate
      marshal-as: reference
      repeatable: true
    - name: Receipts
      description: are receipts for anchors from other partitions that were included in the block
      type: PartitionAnchorReceipt
      marshal-as: reference
      pointer: true
      repeatable: true
    - name: MakeMajorBlock
      description: notifies the partition that the DN has opened a major block
      type: uint
    - name: MakeMajorBlockTime
      description: holds the time when the major block was opened
      type: time

SystemWriteData:
  union: { type: transaction }
  fields:
    - name: Entry
      type: DataEntry
      marshal-as: union
    - name: WriteToState
      description: writes the data entry to the account state
      type: bool
      optional: true

NodeStatusUpdate:
  union: { type: transaction }
  fields:
    - name: Status
      type: NodeStatus
      marshal-as: enum
    - name: Address
      type: string
      optional: true


##### Data Types #####

NetworkAccountUpdate:
  fields:
    - name: Name
      type: string
    - name: Body
      type: TransactionBody
      marshal-as: union

PartitionAnchor:
  fields:
    - name: Source
      description: is the principal of the transaction that produced this transaction
      type: url
      pointer: true
    - name: MajorBlockIndex
      description: is the major block index, or zero
      type: uint
    - name: MinorBlockIndex
      description: is the minor block index
      type: uvarint
    - name: RootChainIndex
      description: is the index of the last root chain entry
      type: uvarint
    - name: RootChainAnchor
      description: is the anchor of the root chain
      type: hash
    - name: StateTreeAnchor
      description: is the root of the source's state tree (BPT)
      type: hash

PartitionAnchorReceipt:
  fields:
    - name: PartitionID
      type: string
    - name: MinorBlockIndex
      description: is the minor block index
      type: uvarint
    - name: RootChainIndex
      description: is the index of the anchored root chain entry
      type: uvarint
    - name: RootChainReceipt
      description: is a receipt for the anchored root chain entry
      type: managed.Receipt
      marshal-as: reference
      pointer: true

PartitionSyntheticLedger:
  fields:
    - name: Url
      description: is the URL of the partition
      type: url
      pointer: true
    - name: Produced
      description: is the maximum sequence number of synthetic transactions produced for the partition
      type: uint
    - name: Received
      description: is the maximum sequence number of synthetic transactions received from the partition
      type: uint
    - name: Delivered
      description: is the maximum sequence number of delivered synthetic transactions received from the partition
      type: uint
    - name: Pending
      description: is the transaction hashes of synthetic transactions received out of order
      type: txid
      pointer: true
      repeatable: true

AddressBookEntries:
  fields:
    - name: Entries
      type: AddressBookEntry
      marshal-as: reference
      pointer: true
      repeatable: true

AddressBookEntry:
  fields:
    - name: PublicKeyHash
      type: hash
    - name: Address
      type: string